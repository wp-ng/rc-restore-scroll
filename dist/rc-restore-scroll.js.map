{"version":3,"file":"rc-restore-scroll.js","sources":["rc-restore-scroll.js"],"sourcesContent":["/**\r\n * RC Restore Scroll\r\n */\r\n(function(rcrs) {\r\n    \"use strict\";\r\n\r\n    //Prevent run twice\r\n    if (rcrs.hasInitialised) {\r\n        return;\r\n    }\r\n\r\n    var utils = {\r\n        removeItem: function(key) {\r\n            if (typeof(sessionStorage) !== 'undefined') {\r\n\r\n                sessionStorage.removeItem(key);\r\n            }\r\n        },\r\n        setItem: function (key, value) {\r\n            if (typeof(sessionStorage) !== 'undefined') {\r\n\r\n                if (typeof value === \"object\") {\r\n                    value = JSON.stringify(value);\r\n                }\r\n\r\n                sessionStorage.setItem(key, value);\r\n            }\r\n        },\r\n        getItem: function (key) {\r\n            if (typeof(sessionStorage) !== 'undefined') {\r\n                try {\r\n\r\n                    var value = sessionStorage.getItem(key);\r\n\r\n                    var obj_val = JSON.parse(value);\r\n\r\n                    return (typeof obj_val === \"object\") ? obj_val : value;\r\n                }\r\n                catch (e) {\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            return null;\r\n        },\r\n        isPlainObject: function(obj) {\r\n            // The code \"typeof obj === 'object' && obj !== null\" allows Array objects\r\n            return (\r\n                typeof obj === 'object' && obj !== null && obj.constructor === Object\r\n            );\r\n        },\r\n        // only used for extending the initial options\r\n        deepExtend: function(target, source) {\r\n            for (var prop in source) {\r\n                if (source.hasOwnProperty(prop)) {\r\n                    if (\r\n                        prop in target &&\r\n                        this.isPlainObject(target[prop]) &&\r\n                        this.isPlainObject(source[prop])\r\n                    ) {\r\n                        this.deepExtend(target[prop], source[prop]);\r\n                    } else {\r\n                        target[prop] = source[prop];\r\n                    }\r\n                }\r\n            }\r\n            return target;\r\n        },\r\n    };\r\n\r\n    var defaultOptions = {\r\n        size: 5,\r\n        timeout: 400,\r\n        offset: 0\r\n    };\r\n\r\n\r\n    rcrs = {\r\n        initialise: function(options) {\r\n\r\n            //Init options\r\n            utils.deepExtend((this.options = {}), defaultOptions);\r\n\r\n            if (utils.isPlainObject(options)) {\r\n                utils.deepExtend(this.options, options);\r\n            }\r\n\r\n            this.history = utils.getItem('scrollHistory') || {};\r\n\r\n            if (typeof this.history === \"object\") {\r\n\r\n                if (!this.history.urls || !Array.isArray(this.history.urls) || !this.history.scrolly || !Array.isArray(this.history.scrolly)) {\r\n                    this.history.urls = [];\r\n                    this.history.scrolly = [];\r\n                }\r\n            }\r\n            else {\r\n                this.history = {\r\n                    urls: [],\r\n                    scrolly: []\r\n                };\r\n            }\r\n\r\n            this.options.size = parseInt(this.options.size, 10);\r\n            this.options.timeout = parseInt(this.options.timeout, 10);\r\n            this.options.offset = parseInt(this.options.offset, 10);\r\n\r\n            if (!this.options.timeout) {\r\n                this.options.timeout =  defaultOptions.timeout;\r\n            }\r\n\r\n            window.addEventListener(\"DOMContentLoaded\", rcrs.restoreScroll);\r\n            window.addEventListener(\"beforeunload\", rcrs.saveScroll);\r\n        },\r\n        setSize: function( num  ) {\r\n\r\n            this.options.size = parseInt(num, 10);\r\n        },\r\n        setTimeout: function( num  ) {\r\n\r\n            this.options.timeout = parseInt(num, 10);\r\n        },\r\n        getSize: function( num  ) {\r\n\r\n            return this.options.size;\r\n        },\r\n        getTimeout: function( num  ) {\r\n\r\n            return this.options.timeout;\r\n        },\r\n        getHistory: function(url) {\r\n\r\n            if (url) {\r\n                var i = this.history.urls.indexOf(url);\r\n\r\n                if (i !== - 1) {\r\n                    return {url: this.history.urls[i], scrolly: this.history.scrolly[i]};\r\n                }\r\n            }\r\n\r\n            return {url: null, scrolly: 0};\r\n        },\r\n        removeHistory: function (url) {\r\n\r\n            var i = this.history.urls.indexOf(url);\r\n            var hi = this.history.urls.indexOf(url + '#/');\r\n\r\n            if (i !== -1) {\r\n                this.history.urls.splice(i, 1);\r\n                this.history.scrolly.splice(i, 1);\r\n            }\r\n\r\n            if (hi !== -1) {\r\n                this.history.urls.splice(hi, 1);\r\n                this.history.scrolly.splice(hi, 1);\r\n\r\n            }\r\n\r\n            if (this.history.urls.length > this.options.size) {\r\n\r\n                for (var ie = 0; ie < this.history.urls.length - this.options.size; ie++) {\r\n\r\n                    this.history.urls.splice(ie, 1);\r\n                    this.history.scrolly.splice(ie, 1);\r\n                }\r\n            }\r\n        },\r\n        addHistory: function(url, position) {\r\n\r\n            var i = this.history.urls.indexOf(url);\r\n\r\n            if (i !== -1) {\r\n                this.history.scrolly[i] = position;\r\n            }\r\n            else {\r\n                this.history.urls.push(url);\r\n                this.history.scrolly.push(position);\r\n            }\r\n        },\r\n        saveHistory: function() {\r\n\r\n            utils.setItem('scrollHistory', this.history);\r\n        },\r\n        restoreScroll: function() {\r\n\r\n            var href = window.location.href;\r\n            var item = rcrs.getHistory(href);\r\n\r\n            if (item.url) {\r\n\r\n                rcrs.removeHistory(item.url);\r\n                rcrs.saveHistory();\r\n\r\n                setTimeout(function() {\r\n\r\n                    window.scrollTo(0, (item.scrolly + rcrs.options.offset));\r\n                }, rcrs.options.timeout);\r\n            }\r\n        },\r\n        saveScroll: function () {\r\n\r\n            var to_url = document.activeElement.href;\r\n            var href = window.location.href;\r\n\r\n            //Back and Next button return activeElement href to undefined.\r\n            //So we can remove the scroll position in history.\r\n            if (to_url) {\r\n\r\n                var item = rcrs.removeHistory(to_url);\r\n            }\r\n\r\n            rcrs.addHistory(href, parseInt(window.scrollY, 10));\r\n            rcrs.saveHistory();\r\n        },\r\n        destroy: function () {\r\n\r\n            window.removeEventListener(\"DOMContentLoaded\", rcrs.restoreScroll);\r\n            window.removeEventListener(\"beforeunload\", rcrs.saveScroll);\r\n        }\r\n    };\r\n\r\n    //Prevent run twice\r\n    rcrs.hasInitialised = true;\r\n\r\n    window.rcrs = rcrs;\r\n})(window.rcrs || {});\r\n\r\nwindow.rcrs.initialise();"],"names":["rcrs","hasInitialised","utils","removeItem","key","sessionStorage","setItem","value","JSON","stringify","getItem","obj_val","parse","e","isPlainObject","obj","constructor","Object","deepExtend","target","source","prop","hasOwnProperty","this","defaultOptions","size","timeout","offset","initialise","options","history","urls","Array","isArray","scrolly","parseInt","window","addEventListener","restoreScroll","saveScroll","setSize","num","setTimeout","getSize","getTimeout","getHistory","url","i","indexOf","removeHistory","hi","splice","length","ie","addHistory","position","push","saveHistory","href","location","item","scrollTo","to_url","document","activeElement","scrollY","destroy","removeEventListener"],"mappings":"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","sourceRoot":"dist"}