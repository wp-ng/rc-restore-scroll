{"version":3,"file":"rc-restore-scroll.js","sources":["rc-restore-scroll.js"],"sourcesContent":["/**\r\n * RC Restore Scroll\r\n */\r\n(function(rcrs) {\r\n    \"use strict\";\r\n\r\n    //Prevent run twice\r\n    if (rcrs.hasInitialised) {\r\n        return;\r\n    }\r\n\r\n    var utils = {\r\n        removeItem: function(key) {\r\n            if (typeof(sessionStorage) !== 'undefined') {\r\n\r\n                sessionStorage.removeItem(key);\r\n            }\r\n        },\r\n        setItem: function (key, value) {\r\n            if (typeof(sessionStorage) !== 'undefined') {\r\n\r\n                if (typeof value === \"object\") {\r\n                    value = JSON.stringify(value);\r\n                }\r\n\r\n                sessionStorage.setItem(key, value);\r\n            }\r\n        },\r\n        getItem: function (key) {\r\n            if (typeof(sessionStorage) !== 'undefined') {\r\n                try {\r\n\r\n                    var value = sessionStorage.getItem(key);\r\n\r\n                    var obj_val = JSON.parse(value);\r\n\r\n                    return (typeof obj_val === \"object\") ? obj_val : value;\r\n                }\r\n                catch (e) {\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            return null;\r\n        },\r\n        isPlainObject: function(obj) {\r\n            // The code \"typeof obj === 'object' && obj !== null\" allows Array objects\r\n            return (\r\n                typeof obj === 'object' && obj !== null && obj.constructor === Object\r\n            );\r\n        },\r\n        // only used for extending the initial options\r\n        deepExtend: function(target, source) {\r\n            for (var prop in source) {\r\n                if (source.hasOwnProperty(prop)) {\r\n                    if (\r\n                        prop in target &&\r\n                        this.isPlainObject(target[prop]) &&\r\n                        this.isPlainObject(source[prop])\r\n                    ) {\r\n                        this.deepExtend(target[prop], source[prop]);\r\n                    } else {\r\n                        target[prop] = source[prop];\r\n                    }\r\n                }\r\n            }\r\n            return target;\r\n        },\r\n    };\r\n\r\n    var defaultOptions = {\r\n        id: null,\r\n        timeoutHeight: 1000,\r\n        size: 25,\r\n        timeout: 300,\r\n        offset: 0\r\n    };\r\n\r\n\r\n    rcrs = {\r\n        initialise: function(options) {\r\n\r\n            //Init options\r\n            utils.deepExtend((this.options = {}), defaultOptions);\r\n\r\n            if (utils.isPlainObject(options)) {\r\n                utils.deepExtend(this.options, options);\r\n            }\r\n\r\n            this.history = utils.getItem('scrollHistory') || {};\r\n\r\n            if (typeof this.history === \"object\") {\r\n\r\n                if (!this.history.urls || !Array.isArray(this.history.urls) || !this.history.scrolly || !Array.isArray(this.history.scrolly)) {\r\n                    this.history.urls = [];\r\n                    this.history.scrolly = [];\r\n                }\r\n            }\r\n            else {\r\n                this.history = {\r\n                    urls: [],\r\n                    scrolly: []\r\n                };\r\n            }\r\n\r\n            this.options.timeoutHeight = parseInt(this.options.timeoutHeight, 10);\r\n            this.options.size = parseInt(this.options.size, 10);\r\n            this.options.timeout = parseInt(this.options.timeout, 10);\r\n            this.options.offset = parseInt(this.options.offset, 10);\r\n\r\n            if (!this.options.timeout) {\r\n                this.options.timeout =  defaultOptions.timeout;\r\n            }\r\n\r\n            window.addEventListener(\"DOMContentLoaded\", rcrs.restoreScroll);\r\n            window.addEventListener(\"beforeunload\", rcrs.saveScroll);\r\n        },\r\n        setSize: function( num  ) {\r\n\r\n            this.options.size = parseInt(num, 10);\r\n        },\r\n        setTimeout: function( num  ) {\r\n\r\n            this.options.timeout = parseInt(num, 10);\r\n        },\r\n        getSize: function( num  ) {\r\n\r\n            return this.options.size;\r\n        },\r\n        getTimeout: function( num  ) {\r\n\r\n            return this.options.timeout;\r\n        },\r\n        getHistory: function(url) {\r\n\r\n            if (url) {\r\n                var i = this.history.urls.indexOf(url);\r\n\r\n                if (i !== - 1) {\r\n                    return {url: this.history.urls[i], scrolly: this.history.scrolly[i]};\r\n                }\r\n            }\r\n\r\n            return {url: null, scrolly: {pos: 0,  id: null, height: null}};\r\n        },\r\n        removeHistory: function (url) {\r\n\r\n            var i = this.history.urls.indexOf(url);\r\n            var hi = this.history.urls.indexOf(url + '#/');\r\n\r\n            if (i !== -1) {\r\n                this.history.urls.splice(i, 1);\r\n                this.history.scrolly.splice(i, 1);\r\n            }\r\n\r\n            if (hi !== -1) {\r\n                this.history.urls.splice(hi, 1);\r\n                this.history.scrolly.splice(hi, 1);\r\n\r\n            }\r\n\r\n            if (this.history.urls.length > this.options.size) {\r\n\r\n                for (var ie = 0; ie < this.history.urls.length - this.options.size; ie++) {\r\n\r\n                    this.history.urls.splice(ie, 1);\r\n                    this.history.scrolly.splice(ie, 1);\r\n                }\r\n            }\r\n        },\r\n        addHistory: function(url, position, id, height) {\r\n\r\n            var i = this.history.urls.indexOf(url);\r\n\r\n            if (i !== -1) {\r\n                this.history.scrolly[i] = {pos: position,  id: id, height: height};\r\n            }\r\n            else {\r\n                this.history.urls.push(url);\r\n                this.history.scrolly.push({pos: position,  id: id, height: height});\r\n            }\r\n        },\r\n        saveHistory: function() {\r\n\r\n            utils.setItem('scrollHistory', this.history);\r\n        },\r\n        restoreScroll: function() {\r\n\r\n            var href = window.location.href;\r\n            var item = rcrs.getHistory(href);\r\n\r\n            if (item.url) {\r\n\r\n                rcrs.removeHistory(item.url);\r\n                rcrs.saveHistory();\r\n\r\n                if (!item.scrolly || typeof item.scrolly !== \"object\") {\r\n                    return;\r\n                }\r\n\r\n                window.scrollTo(0, 0);\r\n\r\n                if (item.scrolly.id && item.scrolly.height) {\r\n\r\n                    var elem_id = document.getElementById(item.scrolly.id);\r\n\r\n                    if (elem_id) {\r\n                        elem_id.style.minHeight = item.scrolly.height + 'px';\r\n\r\n                        setTimeout(function() {\r\n\r\n                            elem_id.style.minHeight = null;\r\n                        }, rcrs.options.timeoutHeight);\r\n                    }\r\n                }\r\n\r\n                setTimeout(function() {\r\n\r\n                    window.scrollTo(0, (item.scrolly.pos + rcrs.options.offset));\r\n                }, rcrs.options.timeout);\r\n            }\r\n        },\r\n        saveScroll: function () {\r\n\r\n            var to_url = document.activeElement.href;\r\n            var href = window.location.href;\r\n\r\n            //Back and Next button return activeElement href to undefined.\r\n            //So we can remove the scroll position in history.\r\n            if (to_url) {\r\n\r\n                var item = rcrs.removeHistory(to_url);\r\n            }\r\n\r\n            var elem_id = document.getElementById(rcrs.options.id);\r\n            var height = (elem_id ? parseInt(elem_id.clientHeight, 10) : null);\r\n\r\n            rcrs.addHistory(href, parseInt(window.scrollY, 10), rcrs.options.id, height);\r\n            rcrs.saveHistory();\r\n        },\r\n        destroy: function () {\r\n\r\n            window.removeEventListener(\"DOMContentLoaded\", rcrs.restoreScroll);\r\n            window.removeEventListener(\"beforeunload\", rcrs.saveScroll);\r\n        }\r\n    };\r\n\r\n    //Prevent run twice\r\n    rcrs.hasInitialised = true;\r\n\r\n    window.rcrs = rcrs;\r\n})(window.rcrs || {});"],"names":["rcrs","hasInitialised","utils","removeItem","key","sessionStorage","setItem","value","JSON","stringify","getItem","obj_val","parse","e","isPlainObject","obj","constructor","Object","deepExtend","target","source","prop","hasOwnProperty","this","defaultOptions","id","timeoutHeight","size","timeout","offset","initialise","options","history","urls","Array","isArray","scrolly","parseInt","window","addEventListener","restoreScroll","saveScroll","setSize","num","setTimeout","getSize","getTimeout","getHistory","url","i","indexOf","pos","height","removeHistory","hi","splice","length","ie","addHistory","position","push","saveHistory","href","location","item","scrollTo","elem_id","document","getElementById","style","minHeight","to_url","activeElement","clientHeight","scrollY","destroy","removeEventListener"],"mappings":"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","sourceRoot":"dist"}